const config = {
  name: "AddComment",
  type: "api",
  path: "/content/:id/comments",
  method: "POST",
  emits: ["comment.added"],
  flows: ["content-workflow"]
};
const handler = async (req, { emit, streams, logger, traceId }) => {
  try {
    const contentId = req.pathParams?.id;
    const body = req.body;
    if (!contentId) {
      return {
        status: 400,
        body: {
          error: "Content ID is required"
        }
      };
    }
    if (!body.userId || !body.userName || !body.text) {
      return {
        status: 400,
        body: {
          error: "Missing required fields",
          required: ["userId", "userName", "text"]
        }
      };
    }
    const commentId = `comment_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;
    const now = (/* @__PURE__ */ new Date()).toISOString();
    const comment = {
      id: commentId,
      contentId,
      userId: body.userId,
      userName: body.userName,
      text: body.text,
      type: body.type || "general",
      targetId: body.targetId,
      createdAt: now,
      updatedAt: now
    };
    await streams.comments.set(contentId, commentId, comment);
    logger.info("Comment added", { contentId, commentId, userId: body.userId });
    await streams.comments.send(
      { groupId: contentId },
      {
        type: "comment_added",
        data: comment
      }
    );
    await emit({
      topic: "comment.added",
      data: {
        contentId,
        commentId,
        userId: body.userId
      }
    });
    return {
      status: 201,
      body: comment
    };
  } catch (error) {
    logger.error("Failed to add comment", { error });
    return {
      status: 500,
      body: {
        error: "Internal server error",
        message: "Failed to add comment"
      }
    };
  }
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vLi4vc3JjL3N0ZXBzL2FwaS9hZGQtY29tbWVudC5zdGVwLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKipcclxuICogQVBJIFN0ZXA6IEFkZCBDb21tZW50XHJcbiAqIFxyXG4gKiBBbGxvd3MgdXNlcnMgdG8gYWRkIGNvbW1lbnRzIG9uIGNvbnRlbnQgYW5hbHlzaXMgb3IgcmVjb21tZW5kYXRpb25zLlxyXG4gKiBDb21tZW50cyBhcmUgc3RvcmVkIGFuZCBicm9hZGNhc3RlZCB0byBhbGwgdmlld2VycyBpbiByZWFsLXRpbWUuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQXBpUm91dGVDb25maWcsIEhhbmRsZXJzIH0gZnJvbSAnbW90aWEnO1xyXG5pbXBvcnQgdHlwZSB7IENvbW1lbnQgfSBmcm9tICcuLi8uLi9zdHJlYW1zL2NvbW1lbnRzLnN0cmVhbS5qcyc7XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnOiBBcGlSb3V0ZUNvbmZpZyA9IHtcclxuICBuYW1lOiAnQWRkQ29tbWVudCcsXHJcbiAgdHlwZTogJ2FwaScsXHJcbiAgcGF0aDogJy9jb250ZW50LzppZC9jb21tZW50cycsXHJcbiAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgZW1pdHM6IFsnY29tbWVudC5hZGRlZCddLFxyXG4gIGZsb3dzOiBbJ2NvbnRlbnQtd29ya2Zsb3cnXVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXI6IEhhbmRsZXJzWydBZGRDb21tZW50J10gPSBhc3luYyAocmVxLCB7IGVtaXQsIHN0cmVhbXMsIGxvZ2dlciwgdHJhY2VJZCB9KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNvbnRlbnRJZCA9IHJlcS5wYXRoUGFyYW1zPy5pZCBhcyBzdHJpbmc7XHJcbiAgICBjb25zdCBib2R5ID0gcmVxLmJvZHkgYXMge1xyXG4gICAgICB1c2VySWQ6IHN0cmluZztcclxuICAgICAgdXNlck5hbWU6IHN0cmluZztcclxuICAgICAgdGV4dDogc3RyaW5nO1xyXG4gICAgICB0eXBlPzogJ2FuYWx5c2lzJyB8ICdyZWNvbW1lbmRhdGlvbicgfCAnZ2VuZXJhbCc7XHJcbiAgICAgIHRhcmdldElkPzogc3RyaW5nO1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoIWNvbnRlbnRJZCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN0YXR1czogNDAwLFxyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIGVycm9yOiAnQ29udGVudCBJRCBpcyByZXF1aXJlZCdcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFib2R5LnVzZXJJZCB8fCAhYm9keS51c2VyTmFtZSB8fCAhYm9keS50ZXh0KSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3RhdHVzOiA0MDAsXHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycsXHJcbiAgICAgICAgICByZXF1aXJlZDogWyd1c2VySWQnLCAndXNlck5hbWUnLCAndGV4dCddXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBjb21tZW50IElEXHJcbiAgICBjb25zdCBjb21tZW50SWQgPSBgY29tbWVudF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWA7XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGNvbW1lbnQgb2JqZWN0XHJcbiAgICBjb25zdCBjb21tZW50OiBDb21tZW50ID0ge1xyXG4gICAgICBpZDogY29tbWVudElkLFxyXG4gICAgICBjb250ZW50SWQsXHJcbiAgICAgIHVzZXJJZDogYm9keS51c2VySWQsXHJcbiAgICAgIHVzZXJOYW1lOiBib2R5LnVzZXJOYW1lLFxyXG4gICAgICB0ZXh0OiBib2R5LnRleHQsXHJcbiAgICAgIHR5cGU6IGJvZHkudHlwZSB8fCAnZ2VuZXJhbCcsXHJcbiAgICAgIHRhcmdldElkOiBib2R5LnRhcmdldElkLFxyXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcclxuICAgICAgdXBkYXRlZEF0OiBub3dcclxuICAgIH07XHJcblxyXG4gICAgLy8gU3RvcmUgY29tbWVudCBpbiBzdHJlYW0gKGdyb3VwSWQgPSBjb250ZW50SWQsIGlkID0gY29tbWVudElkKVxyXG4gICAgYXdhaXQgc3RyZWFtcy5jb21tZW50cy5zZXQoY29udGVudElkLCBjb21tZW50SWQsIGNvbW1lbnQpO1xyXG5cclxuICAgIGxvZ2dlci5pbmZvKCdDb21tZW50IGFkZGVkJywgeyBjb250ZW50SWQsIGNvbW1lbnRJZCwgdXNlcklkOiBib2R5LnVzZXJJZCB9KTtcclxuXHJcbiAgICAvLyBTZW5kIHJlYWwtdGltZSB1cGRhdGUgdG8gYWxsIHZpZXdlcnNcclxuICAgIGF3YWl0IHN0cmVhbXMuY29tbWVudHMuc2VuZChcclxuICAgICAgeyBncm91cElkOiBjb250ZW50SWQgfSxcclxuICAgICAge1xyXG4gICAgICAgIHR5cGU6ICdjb21tZW50X2FkZGVkJyxcclxuICAgICAgICBkYXRhOiBjb21tZW50XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgLy8gRW1pdCBldmVudCBmb3IgcG90ZW50aWFsIGZ1dHVyZSBwcm9jZXNzaW5nXHJcbiAgICBhd2FpdCBlbWl0KHtcclxuICAgICAgdG9waWM6ICdjb21tZW50LmFkZGVkJyxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIGNvbnRlbnRJZCxcclxuICAgICAgICBjb21tZW50SWQsXHJcbiAgICAgICAgdXNlcklkOiBib2R5LnVzZXJJZFxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGF0dXM6IDIwMSxcclxuICAgICAgYm9keTogY29tbWVudFxyXG4gICAgfTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGFkZCBjb21tZW50JywgeyBlcnJvciB9KTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN0YXR1czogNTAwLFxyXG4gICAgICBib2R5OiB7XHJcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gYWRkIGNvbW1lbnQnXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG59O1xyXG5cclxuIl0sCiAgIm1hcHBpbmdzIjogIkFBVU8sTUFBTSxTQUF5QjtBQUFBLEVBQ3BDLE1BQU07QUFBQSxFQUNOLE1BQU07QUFBQSxFQUNOLE1BQU07QUFBQSxFQUNOLFFBQVE7QUFBQSxFQUNSLE9BQU8sQ0FBQyxlQUFlO0FBQUEsRUFDdkIsT0FBTyxDQUFDLGtCQUFrQjtBQUM1QjtBQUVPLE1BQU0sVUFBa0MsT0FBTyxLQUFLLEVBQUUsTUFBTSxTQUFTLFFBQVEsUUFBUSxNQUFNO0FBQ2hHLE1BQUk7QUFDRixVQUFNLFlBQVksSUFBSSxZQUFZO0FBQ2xDLFVBQU0sT0FBTyxJQUFJO0FBUWpCLFFBQUksQ0FBQyxXQUFXO0FBQ2QsYUFBTztBQUFBLFFBQ0wsUUFBUTtBQUFBLFFBQ1IsTUFBTTtBQUFBLFVBQ0osT0FBTztBQUFBLFFBQ1Q7QUFBQSxNQUNGO0FBQUEsSUFDRjtBQUVBLFFBQUksQ0FBQyxLQUFLLFVBQVUsQ0FBQyxLQUFLLFlBQVksQ0FBQyxLQUFLLE1BQU07QUFDaEQsYUFBTztBQUFBLFFBQ0wsUUFBUTtBQUFBLFFBQ1IsTUFBTTtBQUFBLFVBQ0osT0FBTztBQUFBLFVBQ1AsVUFBVSxDQUFDLFVBQVUsWUFBWSxNQUFNO0FBQUEsUUFDekM7QUFBQSxNQUNGO0FBQUEsSUFDRjtBQUdBLFVBQU0sWUFBWSxXQUFXLEtBQUssSUFBSSxDQUFDLElBQUksS0FBSyxPQUFPLEVBQUUsU0FBUyxFQUFFLEVBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQztBQUNyRixVQUFNLE9BQU0sb0JBQUksS0FBSyxHQUFFLFlBQVk7QUFHbkMsVUFBTSxVQUFtQjtBQUFBLE1BQ3ZCLElBQUk7QUFBQSxNQUNKO0FBQUEsTUFDQSxRQUFRLEtBQUs7QUFBQSxNQUNiLFVBQVUsS0FBSztBQUFBLE1BQ2YsTUFBTSxLQUFLO0FBQUEsTUFDWCxNQUFNLEtBQUssUUFBUTtBQUFBLE1BQ25CLFVBQVUsS0FBSztBQUFBLE1BQ2YsV0FBVztBQUFBLE1BQ1gsV0FBVztBQUFBLElBQ2I7QUFHQSxVQUFNLFFBQVEsU0FBUyxJQUFJLFdBQVcsV0FBVyxPQUFPO0FBRXhELFdBQU8sS0FBSyxpQkFBaUIsRUFBRSxXQUFXLFdBQVcsUUFBUSxLQUFLLE9BQU8sQ0FBQztBQUcxRSxVQUFNLFFBQVEsU0FBUztBQUFBLE1BQ3JCLEVBQUUsU0FBUyxVQUFVO0FBQUEsTUFDckI7QUFBQSxRQUNFLE1BQU07QUFBQSxRQUNOLE1BQU07QUFBQSxNQUNSO0FBQUEsSUFDRjtBQUdBLFVBQU0sS0FBSztBQUFBLE1BQ1QsT0FBTztBQUFBLE1BQ1AsTUFBTTtBQUFBLFFBQ0o7QUFBQSxRQUNBO0FBQUEsUUFDQSxRQUFRLEtBQUs7QUFBQSxNQUNmO0FBQUEsSUFDRixDQUFDO0FBRUQsV0FBTztBQUFBLE1BQ0wsUUFBUTtBQUFBLE1BQ1IsTUFBTTtBQUFBLElBQ1I7QUFBQSxFQUVGLFNBQVMsT0FBTztBQUNkLFdBQU8sTUFBTSx5QkFBeUIsRUFBRSxNQUFNLENBQUM7QUFDL0MsV0FBTztBQUFBLE1BQ0wsUUFBUTtBQUFBLE1BQ1IsTUFBTTtBQUFBLFFBQ0osT0FBTztBQUFBLFFBQ1AsU0FBUztBQUFBLE1BQ1g7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUNGOyIsCiAgIm5hbWVzIjogW10KfQo=
