const config = {
  name: "CreateContent",
  type: "api",
  path: "/content",
  method: "POST",
  emits: ["content.created"],
  flows: ["content-workflow"]
};
const handler = async (req, { emit, state, logger, traceId }) => {
  try {
    const body = req.body;
    if (!body.title || !body.body || !body.author || !body.language) {
      logger.warn("Missing required fields", { body });
      return {
        status: 400,
        body: {
          error: "Missing required fields",
          required: ["title", "body", "author", "language"]
        }
      };
    }
    const timestamp = Date.now();
    const randomSuffix = Math.random().toString(36).substring(2, 9);
    const contentId = `content_${timestamp}_${randomSuffix}`;
    const now = (/* @__PURE__ */ new Date()).toISOString();
    const initialStatus = "pending";
    const contentState = {
      contentId,
      title: body.title,
      body: body.body,
      author: body.author,
      language: body.language,
      userId: body.userId,
      // Store userId for filtering
      createdAt: now,
      updatedAt: now,
      workflowStatus: initialStatus
    };
    await state.set("content", contentId, contentState);
    await state.set("workflow", contentId, { status: initialStatus, contentId });
    logger.info("Content created", { contentId, author: body.author });
    await emit({
      topic: "content.created",
      data: {
        contentId,
        traceId
      }
    });
    return {
      status: 201,
      body: {
        contentId,
        status: initialStatus,
        message: "Content submitted successfully. Analysis in progress."
      }
    };
  } catch (error) {
    logger.error("Failed to create content", { error });
    return {
      status: 500,
      body: {
        error: "Internal server error",
        message: "Failed to process content submission"
      }
    };
  }
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vLi4vc3JjL3N0ZXBzL2FwaS9jcmVhdGUtY29udGVudC5zdGVwLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKipcbiAqIEFQSSBTdGVwOiBDcmVhdGUgQ29udGVudFxuICogXG4gKiBFbnRyeSBwb2ludCBmb3IgY29udGVudCBzdWJtaXNzaW9uIHdvcmtmbG93LlxuICogQWNjZXB0cyBjb250ZW50IGlucHV0LCBnZW5lcmF0ZXMgdW5pcXVlIElELCBwZXJzaXN0cyBpbml0aWFsIHN0YXRlLFxuICogYW5kIGVtaXRzIGV2ZW50IHRvIHRyaWdnZXIgdmFsaWRhdGlvbiB3b3JrZmxvdy5cbiAqL1xuXG5pbXBvcnQgeyBBcGlSb3V0ZUNvbmZpZywgSGFuZGxlcnMgfSBmcm9tICdtb3RpYSc7XG5pbXBvcnQgdHlwZSB7IENvbnRlbnRJbnB1dCwgQ29udGVudFN0YXRlLCBXb3JrZmxvd1N0YXR1cyB9IGZyb20gJy4uLy4uL3R5cGVzL2luZGV4LmpzJztcblxuZXhwb3J0IGNvbnN0IGNvbmZpZzogQXBpUm91dGVDb25maWcgPSB7XG4gIG5hbWU6ICdDcmVhdGVDb250ZW50JyxcbiAgdHlwZTogJ2FwaScsXG4gIHBhdGg6ICcvY29udGVudCcsXG4gIG1ldGhvZDogJ1BPU1QnLFxuICBlbWl0czogWydjb250ZW50LmNyZWF0ZWQnXSxcbiAgZmxvd3M6IFsnY29udGVudC13b3JrZmxvdyddXG59O1xuXG5leHBvcnQgY29uc3QgaGFuZGxlcjogSGFuZGxlcnNbJ0NyZWF0ZUNvbnRlbnQnXSA9IGFzeW5jIChyZXEsIHsgZW1pdCwgc3RhdGUsIGxvZ2dlciwgdHJhY2VJZCB9KSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gVmFsaWRhdGUgcmVxdWVzdCBib2R5XG4gICAgY29uc3QgYm9keSA9IHJlcS5ib2R5IGFzIFBhcnRpYWw8Q29udGVudElucHV0PjtcbiAgICBcbiAgICBpZiAoIWJvZHkudGl0bGUgfHwgIWJvZHkuYm9keSB8fCAhYm9keS5hdXRob3IgfHwgIWJvZHkubGFuZ3VhZ2UpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycsIHsgYm9keSB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogNDAwLFxuICAgICAgICBib2R5OiB7XG4gICAgICAgICAgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycsXG4gICAgICAgICAgcmVxdWlyZWQ6IFsndGl0bGUnLCAnYm9keScsICdhdXRob3InLCAnbGFuZ3VhZ2UnXVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBjb250ZW50IElEIHVzaW5nIHRpbWVzdGFtcCArIHJhbmRvbSBzdWZmaXhcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJhbmRvbVN1ZmZpeCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA5KTtcbiAgICBjb25zdCBjb250ZW50SWQgPSBgY29udGVudF8ke3RpbWVzdGFtcH1fJHtyYW5kb21TdWZmaXh9YDtcblxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBjb25zdCBpbml0aWFsU3RhdHVzOiBXb3JrZmxvd1N0YXR1cyA9ICdwZW5kaW5nJztcblxuICAgIC8vIFByZXBhcmUgaW5pdGlhbCBjb250ZW50IHN0YXRlXG4gICAgY29uc3QgY29udGVudFN0YXRlOiBDb250ZW50U3RhdGUgPSB7XG4gICAgICBjb250ZW50SWQsXG4gICAgICB0aXRsZTogYm9keS50aXRsZSxcbiAgICAgIGJvZHk6IGJvZHkuYm9keSxcbiAgICAgIGF1dGhvcjogYm9keS5hdXRob3IsXG4gICAgICBsYW5ndWFnZTogYm9keS5sYW5ndWFnZSxcbiAgICAgIHVzZXJJZDogYm9keS51c2VySWQsIC8vIFN0b3JlIHVzZXJJZCBmb3IgZmlsdGVyaW5nXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgd29ya2Zsb3dTdGF0dXM6IGluaXRpYWxTdGF0dXNcbiAgICB9O1xuXG4gICAgLy8gUGVyc2lzdCBpbml0aWFsIGNvbnRlbnQgaW4gTW90aWEgc3RhdGUgKHVzZSAnY29udGVudCcgYXMgZ3JvdXBJZCwgbm90IHRyYWNlSWQpXG4gICAgYXdhaXQgc3RhdGUuc2V0KCdjb250ZW50JywgY29udGVudElkLCBjb250ZW50U3RhdGUpO1xuICAgIGF3YWl0IHN0YXRlLnNldCgnd29ya2Zsb3cnLCBjb250ZW50SWQsIHsgc3RhdHVzOiBpbml0aWFsU3RhdHVzLCBjb250ZW50SWQgfSk7XG5cbiAgICBsb2dnZXIuaW5mbygnQ29udGVudCBjcmVhdGVkJywgeyBjb250ZW50SWQsIGF1dGhvcjogYm9keS5hdXRob3IgfSk7XG5cbiAgICAvLyBFbWl0IGV2ZW50IHRvIHRyaWdnZXIgdmFsaWRhdGlvbiB3b3JrZmxvd1xuICAgIGF3YWl0IGVtaXQoe1xuICAgICAgdG9waWM6ICdjb250ZW50LmNyZWF0ZWQnLFxuICAgICAgZGF0YToge1xuICAgICAgICBjb250ZW50SWQsXG4gICAgICAgIHRyYWNlSWRcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFJldHVybiBpbW1lZGlhdGUgcmVzcG9uc2Ugd2l0aCBjb250ZW50SWQgYW5kIHN0YXR1c1xuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXM6IDIwMSxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgY29udGVudElkLFxuICAgICAgICBzdGF0dXM6IGluaXRpYWxTdGF0dXMsXG4gICAgICAgIG1lc3NhZ2U6ICdDb250ZW50IHN1Ym1pdHRlZCBzdWNjZXNzZnVsbHkuIEFuYWx5c2lzIGluIHByb2dyZXNzLidcbiAgICAgIH1cbiAgICB9O1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGNvbnRlbnQnLCB7IGVycm9yIH0pO1xuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXM6IDUwMCxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHByb2Nlc3MgY29udGVudCBzdWJtaXNzaW9uJ1xuICAgICAgfVxuICAgIH07XG4gIH1cbn07XG5cbiJdLAogICJtYXBwaW5ncyI6ICJBQVdPLE1BQU0sU0FBeUI7QUFBQSxFQUNwQyxNQUFNO0FBQUEsRUFDTixNQUFNO0FBQUEsRUFDTixNQUFNO0FBQUEsRUFDTixRQUFRO0FBQUEsRUFDUixPQUFPLENBQUMsaUJBQWlCO0FBQUEsRUFDekIsT0FBTyxDQUFDLGtCQUFrQjtBQUM1QjtBQUVPLE1BQU0sVUFBcUMsT0FBTyxLQUFLLEVBQUUsTUFBTSxPQUFPLFFBQVEsUUFBUSxNQUFNO0FBQ2pHLE1BQUk7QUFFRixVQUFNLE9BQU8sSUFBSTtBQUVqQixRQUFJLENBQUMsS0FBSyxTQUFTLENBQUMsS0FBSyxRQUFRLENBQUMsS0FBSyxVQUFVLENBQUMsS0FBSyxVQUFVO0FBQy9ELGFBQU8sS0FBSywyQkFBMkIsRUFBRSxLQUFLLENBQUM7QUFDL0MsYUFBTztBQUFBLFFBQ0wsUUFBUTtBQUFBLFFBQ1IsTUFBTTtBQUFBLFVBQ0osT0FBTztBQUFBLFVBQ1AsVUFBVSxDQUFDLFNBQVMsUUFBUSxVQUFVLFVBQVU7QUFBQSxRQUNsRDtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBR0EsVUFBTSxZQUFZLEtBQUssSUFBSTtBQUMzQixVQUFNLGVBQWUsS0FBSyxPQUFPLEVBQUUsU0FBUyxFQUFFLEVBQUUsVUFBVSxHQUFHLENBQUM7QUFDOUQsVUFBTSxZQUFZLFdBQVcsU0FBUyxJQUFJLFlBQVk7QUFFdEQsVUFBTSxPQUFNLG9CQUFJLEtBQUssR0FBRSxZQUFZO0FBQ25DLFVBQU0sZ0JBQWdDO0FBR3RDLFVBQU0sZUFBNkI7QUFBQSxNQUNqQztBQUFBLE1BQ0EsT0FBTyxLQUFLO0FBQUEsTUFDWixNQUFNLEtBQUs7QUFBQSxNQUNYLFFBQVEsS0FBSztBQUFBLE1BQ2IsVUFBVSxLQUFLO0FBQUEsTUFDZixRQUFRLEtBQUs7QUFBQTtBQUFBLE1BQ2IsV0FBVztBQUFBLE1BQ1gsV0FBVztBQUFBLE1BQ1gsZ0JBQWdCO0FBQUEsSUFDbEI7QUFHQSxVQUFNLE1BQU0sSUFBSSxXQUFXLFdBQVcsWUFBWTtBQUNsRCxVQUFNLE1BQU0sSUFBSSxZQUFZLFdBQVcsRUFBRSxRQUFRLGVBQWUsVUFBVSxDQUFDO0FBRTNFLFdBQU8sS0FBSyxtQkFBbUIsRUFBRSxXQUFXLFFBQVEsS0FBSyxPQUFPLENBQUM7QUFHakUsVUFBTSxLQUFLO0FBQUEsTUFDVCxPQUFPO0FBQUEsTUFDUCxNQUFNO0FBQUEsUUFDSjtBQUFBLFFBQ0E7QUFBQSxNQUNGO0FBQUEsSUFDRixDQUFDO0FBR0QsV0FBTztBQUFBLE1BQ0wsUUFBUTtBQUFBLE1BQ1IsTUFBTTtBQUFBLFFBQ0o7QUFBQSxRQUNBLFFBQVE7QUFBQSxRQUNSLFNBQVM7QUFBQSxNQUNYO0FBQUEsSUFDRjtBQUFBLEVBRUYsU0FBUyxPQUFPO0FBQ2QsV0FBTyxNQUFNLDRCQUE0QixFQUFFLE1BQU0sQ0FBQztBQUNsRCxXQUFPO0FBQUEsTUFDTCxRQUFRO0FBQUEsTUFDUixNQUFNO0FBQUEsUUFDSixPQUFPO0FBQUEsUUFDUCxTQUFTO0FBQUEsTUFDWDtBQUFBLElBQ0Y7QUFBQSxFQUNGO0FBQ0Y7IiwKICAibmFtZXMiOiBbXQp9Cg==
