const config = {
  name: "ListContent",
  type: "api",
  path: "/content",
  method: "GET",
  emits: [],
  flows: ["content-workflow"]
};
const handler = async (req, { state, logger, traceId }) => {
  try {
    const userIdParam = req.queryParams?.userId;
    const userId = Array.isArray(userIdParam) ? userIdParam[0] : userIdParam;
    logger.info("Fetching content", { userId: userId || "all" });
    const allContent = await state.getGroup("content");
    if (!allContent || allContent.length === 0) {
      return {
        status: 200,
        body: []
      };
    }
    let filteredContent = allContent;
    if (userId) {
      filteredContent = allContent.filter(
        (content) => content.userId === userId
      );
      logger.info("Filtered content by userId", { userId, count: filteredContent.length });
    }
    const contentList = filteredContent.map((contentState) => ({
      id: contentState.contentId,
      contentId: contentState.contentId,
      title: contentState.title,
      author: contentState.author,
      status: contentState.workflowStatus,
      createdAt: contentState.createdAt,
      updatedAt: contentState.updatedAt
    }));
    contentList.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());
    logger.info("Content list fetched", { count: contentList.length, filtered: !!userId });
    return {
      status: 200,
      body: contentList
    };
  } catch (error) {
    logger.error("Failed to list content", { error });
    return {
      status: 500,
      body: {
        error: "Internal server error",
        message: "Failed to fetch content list"
      }
    };
  }
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vLi4vc3JjL3N0ZXBzL2FwaS9saXN0LWNvbnRlbnQuc3RlcC50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXHJcbiAqIEFQSSBTdGVwOiBMaXN0IENvbnRlbnRcclxuICogXHJcbiAqIExpc3RzIGFsbCBjb250ZW50IGl0ZW1zIGZvciBkYXNoYm9hcmQgZGlzcGxheS5cclxuICogUmV0dXJucyBhcnJheSBvZiBjb250ZW50IHN1bW1hcmllcy5cclxuICovXHJcblxyXG5pbXBvcnQgeyBBcGlSb3V0ZUNvbmZpZywgSGFuZGxlcnMgfSBmcm9tICdtb3RpYSc7XHJcbmltcG9ydCB0eXBlIHsgQ29udGVudFN0YXRlIH0gZnJvbSAnLi4vLi4vdHlwZXMvaW5kZXguanMnO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZzogQXBpUm91dGVDb25maWcgPSB7XHJcbiAgbmFtZTogJ0xpc3RDb250ZW50JyxcclxuICB0eXBlOiAnYXBpJyxcclxuICBwYXRoOiAnL2NvbnRlbnQnLFxyXG4gIG1ldGhvZDogJ0dFVCcsXHJcbiAgZW1pdHM6IFtdLFxyXG4gIGZsb3dzOiBbJ2NvbnRlbnQtd29ya2Zsb3cnXVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXI6IEhhbmRsZXJzWydMaXN0Q29udGVudCddID0gYXN5bmMgKHJlcSwgeyBzdGF0ZSwgbG9nZ2VyLCB0cmFjZUlkIH0pID0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gRXh0cmFjdCB1c2VySWQgZnJvbSBxdWVyeSBwYXJhbWV0ZXJzIGlmIHByb3ZpZGVkXHJcbiAgICAvLyBRdWVyeSBwYXJhbXMgY2FuIGJlIHN0cmluZyBvciBzdHJpbmdbXSwgc28gaGFuZGxlIGJvdGggY2FzZXNcclxuICAgIGNvbnN0IHVzZXJJZFBhcmFtID0gcmVxLnF1ZXJ5UGFyYW1zPy51c2VySWQ7XHJcbiAgICBjb25zdCB1c2VySWQgPSBBcnJheS5pc0FycmF5KHVzZXJJZFBhcmFtKSA/IHVzZXJJZFBhcmFtWzBdIDogdXNlcklkUGFyYW07XHJcbiAgICBcclxuICAgIGxvZ2dlci5pbmZvKCdGZXRjaGluZyBjb250ZW50JywgeyB1c2VySWQ6IHVzZXJJZCB8fCAnYWxsJyB9KTtcclxuXHJcbiAgICAvLyBHZXQgYWxsIGNvbnRlbnQgZnJvbSBzdGF0ZSB1c2luZyBnZXRHcm91cFxyXG4gICAgY29uc3QgYWxsQ29udGVudCA9IGF3YWl0IHN0YXRlLmdldEdyb3VwKCdjb250ZW50JykgYXMgQ29udGVudFN0YXRlW10gfCBudWxsO1xyXG5cclxuICAgIGlmICghYWxsQ29udGVudCB8fCBhbGxDb250ZW50Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN0YXR1czogMjAwLFxyXG4gICAgICAgIGJvZHk6IFtdXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmlsdGVyIGJ5IHVzZXJJZCBpZiBwcm92aWRlZFxyXG4gICAgbGV0IGZpbHRlcmVkQ29udGVudCA9IGFsbENvbnRlbnQ7XHJcbiAgICBpZiAodXNlcklkKSB7XHJcbiAgICAgIGZpbHRlcmVkQ29udGVudCA9IGFsbENvbnRlbnQuZmlsdGVyKChjb250ZW50OiBDb250ZW50U3RhdGUpID0+IFxyXG4gICAgICAgIGNvbnRlbnQudXNlcklkID09PSB1c2VySWRcclxuICAgICAgKTtcclxuICAgICAgbG9nZ2VyLmluZm8oJ0ZpbHRlcmVkIGNvbnRlbnQgYnkgdXNlcklkJywgeyB1c2VySWQsIGNvdW50OiBmaWx0ZXJlZENvbnRlbnQubGVuZ3RoIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJldHVybiBzaW1wbGlmaWVkIGNvbnRlbnQgbGlzdCBmb3IgZGFzaGJvYXJkXHJcbiAgICBjb25zdCBjb250ZW50TGlzdCA9IGZpbHRlcmVkQ29udGVudC5tYXAoKGNvbnRlbnRTdGF0ZTogQ29udGVudFN0YXRlKSA9PiAoe1xyXG4gICAgICBpZDogY29udGVudFN0YXRlLmNvbnRlbnRJZCxcclxuICAgICAgY29udGVudElkOiBjb250ZW50U3RhdGUuY29udGVudElkLFxyXG4gICAgICB0aXRsZTogY29udGVudFN0YXRlLnRpdGxlLFxyXG4gICAgICBhdXRob3I6IGNvbnRlbnRTdGF0ZS5hdXRob3IsXHJcbiAgICAgIHN0YXR1czogY29udGVudFN0YXRlLndvcmtmbG93U3RhdHVzLFxyXG4gICAgICBjcmVhdGVkQXQ6IGNvbnRlbnRTdGF0ZS5jcmVhdGVkQXQsXHJcbiAgICAgIHVwZGF0ZWRBdDogY29udGVudFN0YXRlLnVwZGF0ZWRBdFxyXG4gICAgfSkpO1xyXG5cclxuICAgIC8vIFNvcnQgYnkgY3JlYXRlZEF0IGRlc2NlbmRpbmcgKG5ld2VzdCBmaXJzdClcclxuICAgIGNvbnRlbnRMaXN0LnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIuY3JlYXRlZEF0KS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShhLmNyZWF0ZWRBdCkuZ2V0VGltZSgpKTtcclxuXHJcbiAgICBsb2dnZXIuaW5mbygnQ29udGVudCBsaXN0IGZldGNoZWQnLCB7IGNvdW50OiBjb250ZW50TGlzdC5sZW5ndGgsIGZpbHRlcmVkOiAhIXVzZXJJZCB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGF0dXM6IDIwMCxcclxuICAgICAgYm9keTogY29udGVudExpc3RcclxuICAgIH07XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBsaXN0IGNvbnRlbnQnLCB7IGVycm9yIH0pO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzOiA1MDAsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXHJcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBjb250ZW50IGxpc3QnXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG59O1xyXG5cclxuIl0sCiAgIm1hcHBpbmdzIjogIkFBVU8sTUFBTSxTQUF5QjtBQUFBLEVBQ3BDLE1BQU07QUFBQSxFQUNOLE1BQU07QUFBQSxFQUNOLE1BQU07QUFBQSxFQUNOLFFBQVE7QUFBQSxFQUNSLE9BQU8sQ0FBQztBQUFBLEVBQ1IsT0FBTyxDQUFDLGtCQUFrQjtBQUM1QjtBQUVPLE1BQU0sVUFBbUMsT0FBTyxLQUFLLEVBQUUsT0FBTyxRQUFRLFFBQVEsTUFBTTtBQUN6RixNQUFJO0FBR0YsVUFBTSxjQUFjLElBQUksYUFBYTtBQUNyQyxVQUFNLFNBQVMsTUFBTSxRQUFRLFdBQVcsSUFBSSxZQUFZLENBQUMsSUFBSTtBQUU3RCxXQUFPLEtBQUssb0JBQW9CLEVBQUUsUUFBUSxVQUFVLE1BQU0sQ0FBQztBQUczRCxVQUFNLGFBQWEsTUFBTSxNQUFNLFNBQVMsU0FBUztBQUVqRCxRQUFJLENBQUMsY0FBYyxXQUFXLFdBQVcsR0FBRztBQUMxQyxhQUFPO0FBQUEsUUFDTCxRQUFRO0FBQUEsUUFDUixNQUFNLENBQUM7QUFBQSxNQUNUO0FBQUEsSUFDRjtBQUdBLFFBQUksa0JBQWtCO0FBQ3RCLFFBQUksUUFBUTtBQUNWLHdCQUFrQixXQUFXO0FBQUEsUUFBTyxDQUFDLFlBQ25DLFFBQVEsV0FBVztBQUFBLE1BQ3JCO0FBQ0EsYUFBTyxLQUFLLDhCQUE4QixFQUFFLFFBQVEsT0FBTyxnQkFBZ0IsT0FBTyxDQUFDO0FBQUEsSUFDckY7QUFHQSxVQUFNLGNBQWMsZ0JBQWdCLElBQUksQ0FBQyxrQkFBZ0M7QUFBQSxNQUN2RSxJQUFJLGFBQWE7QUFBQSxNQUNqQixXQUFXLGFBQWE7QUFBQSxNQUN4QixPQUFPLGFBQWE7QUFBQSxNQUNwQixRQUFRLGFBQWE7QUFBQSxNQUNyQixRQUFRLGFBQWE7QUFBQSxNQUNyQixXQUFXLGFBQWE7QUFBQSxNQUN4QixXQUFXLGFBQWE7QUFBQSxJQUMxQixFQUFFO0FBR0YsZ0JBQVksS0FBSyxDQUFDLEdBQUcsTUFBTSxJQUFJLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxJQUFJLElBQUksS0FBSyxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUM7QUFFNUYsV0FBTyxLQUFLLHdCQUF3QixFQUFFLE9BQU8sWUFBWSxRQUFRLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUVyRixXQUFPO0FBQUEsTUFDTCxRQUFRO0FBQUEsTUFDUixNQUFNO0FBQUEsSUFDUjtBQUFBLEVBRUYsU0FBUyxPQUFPO0FBQ2QsV0FBTyxNQUFNLDBCQUEwQixFQUFFLE1BQU0sQ0FBQztBQUNoRCxXQUFPO0FBQUEsTUFDTCxRQUFRO0FBQUEsTUFDUixNQUFNO0FBQUEsUUFDSixPQUFPO0FBQUEsUUFDUCxTQUFTO0FBQUEsTUFDWDtBQUFBLElBQ0Y7QUFBQSxFQUNGO0FBQ0Y7IiwKICAibmFtZXMiOiBbXQp9Cg==
